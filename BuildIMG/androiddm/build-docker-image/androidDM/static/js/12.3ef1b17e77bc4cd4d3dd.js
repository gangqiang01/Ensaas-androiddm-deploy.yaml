webpackJsonp([12],{a33h:function(t,e){},l5iW:function(t,e){},lVEa:function(t,e){},"rpV+":function(t,e){},sYsL:function(t,e,a){"use strict";a.d(e,"a",function(){return l});var n=a("rVsN"),i=a.n(n),s=a("5Y2G"),o=a("OT2R"),l=function(t){return new i.a(function(e,a){var n={type:t};Object(o.c)().then(function(t){var a=t+"/exeByType";Object(s.h)(a,n).then(function(t){e(t)}).catch(function(t){e(t.response)})})})}},ujXi:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("42+z"),i=a("FM1y"),s=a("HvBW"),o=a("jwu5"),l=a("jnx8"),r=a("YMj5"),c=a("sYsL"),u=a("22O3"),p=a("OT2R"),d=a("/eZD"),g=a("UuJD"),h={name:"winPkgControlHistory",data:function(){return{pkgStatusHistoryTableList:[],isshow:!1,limit:10,dataCount:0,currentPage:1,multipleSelection:[],isShowBtnGroup:!1,clearLoading:!1,batchDeleteAppStatusHistory:g.a,intervalTime:7e3,isInterval:!1,listLoading:!1,singleWinPkgType:d.K,batchWinPkgType:d.l,statusArray:[]}},components:{btnGroup:a("C+p8").a},props:{statusType:{default:d.l,type:String},selectedAgentId:{default:"",type:String},groupname:{default:"",type:String}},methods:{selectItem:function(t){this.multipleSelection=t},checkSelectable:function(t){return 0==!t.status},handleCurrentChange:function(t){this.currentPage=t||1,this.intervalGetPkgStatusHistory()},deleteHistory:function(t){var e=this;_g.swalInfoDo(this.$t("global.areYouSure"),this.$t("global.delete"),this.$t("global.confirm"),this.$t("global.cancel")).then(function(a){a&&(e.listLoading=!0,Object(g.d)(t).then(function(t){e.listLoading=!1,Object(l.a)(t,function(t){"CHANGED"===t.status?e.$swal("",e.$t("global.success"),"success",{button:e.$t("global.confirm")}).then(function(){e.intervalGetPkgStatusHistory()}):_g.handleError(t)})}))})},checkAppStatusData:function(){this.statusType==d.l?Object(g.f)(this.groupname,this.statusType):Object(g.e)(this.selectedAgentId,this.statusType)},getAppStatusHistoryByGroupname:function(){var t=this;this.groupname||console.error("[getAppStatusHistoryByGroupname]groupname is empty"),!1===this.isInterval&&(this.listLoading=!0),this.statusArray.length>0?Object(g.h)(this.groupname,this.statusType,this.currentPage,this.limit,this.statusArray).then(function(e){t.listLoading=!1,Object(l.a)(e,function(e){t.assignAppStatusData(e)})}):Object(g.j)(this.groupname,this.statusType,this.currentPage,this.limit).then(function(e){t.listLoading=!1,Object(l.a)(e,function(e){t.assignAppStatusData(e)})})},getAppStatusHistoryBydevid:function(){var t=this;this.selectedAgentId||console.error("[getAppStatusHistoryBydevid]selectedAgentId is empty"),!1===this.isInterval&&(this.listLoading=!0),this.statusArray.length>0?Object(g.g)(this.selectedAgentId,this.statusType,this.currentPage,this.limit,this.statusArray).then(function(e){t.listLoading=!1,Object(l.a)(e,function(e){t.assignAppStatusData(e)})}):Object(g.i)(this.selectedAgentId,this.statusType,this.currentPage,this.limit).then(function(e){t.listLoading=!1,Object(l.a)(e,function(e){t.assignAppStatusData(e)})})},assignAppStatusData:function(t){if("[object Object]"===Object.prototype.toString.call(t)&&"[object Array]"===Object.prototype.toString.call(t.data)){this.dataCount=t.count,this.pkgStatusHistoryTableList=t.data,this.isshow=this.dataCount>this.limit,this.isShowBtnGroup=this.dataCount>0;var e=!0;this.statusType==d.l&&this.$emit("getStatusCount"),t.data.forEach(function(t){0==t.status&&(e=!1)}),e&&(this.$emit("isFinished"),window.clearInterval(_g.timer),_g.timer=null)}else window.clearInterval(_g.timer),_g.timer=null},intervalGetPkgStatusHistory:function(){var t=this;this.statusType==d.l?(this.getAppStatusHistoryByGroupname(),null===_g.timer&&(_g.timer=window.setInterval(function(){t.getAppStatusHistoryByGroupname(),t.isInterval=!0},this.intervalTime))):(this.getAppStatusHistoryBydevid(),null===_g.timer&&(_g.timer=window.setInterval(function(){t.getAppStatusHistoryBydevid(),t.isInterval=!0},this.intervalTime)))},filterStatus:function(t){this.statusArray=t.status,this.currentPage=1,_g.isArray(this.statusArray)&&this.intervalGetPkgStatusHistory()},resetAppSensor:function(t,e,a){var n=this;this.listLoading=!0,Object(r.g)(e,t,a).then(function(t){n.listLoading=!1,Object(l.a)(t,function(t){"CHANGED"==t.status?(n.activeName="appStatusHistory",n.currentPage=1,n.intervalGetPkgStatusHistory()):_g.handleError(t)})})},reinstall:function(t){var e=this;_g.swalInfoDo(this.$t("global.areYouSure"),this.$t("winPkgControl.repeat"),this.$t("global.confirm"),this.$t("global.cancel")).then(function(a){if(a){var n={taskname:t.taskname,projectname:t.pkgname,version:t.versionname,downloadpath:t.address,tool:t.versioncode};e.resetAppSensor(t.target,t.deviceId,n)}})},isSuccess:function(t){t&&this.intervalGetPkgStatusHistory()},clearAll:function(){var t=this;_g.swalInfoDo(this.$t("global.areYouSure"),this.$t("global.clearAll"),this.$t("global.confirm"),this.$t("global.cancel")).then(function(e){e&&(t.clearLoading=!0,t.statusType==d.l?Object(g.c)(t.groupname,t.statusType).then(function(e){t.clearLoading=!1,Object(l.a)(e,function(e){"CHANGED"===e.status?t.$swal("",t.$t("global.success"),"success",{button:t.$t("global.confirm")}).then(function(){t.intervalGetPkgStatusHistory()}):_g.handleError(e)})}):Object(g.b)(t.selectedAgentId,t.statusType).then(function(e){t.clearLoading=!1,Object(l.a)(e,function(e){"CHANGED"===e.status?t.$swal("",t.$t("global.success"),"success",{button:t.$t("global.confirm")}).then(function(){t.intervalGetPkgStatusHistory()}):_g.handleError(e)})}))})},initData:function(){this.pkgStatusHistoryTableList=[],this.isShowBtnGroup=!1,this.isshow=!1,this.isInterval=!1,this.currentPage=1}},created:function(){this.statusType==d.l&&this.$emit("getStatusCount")},beforeDestroy:function(){window.clearInterval(_g.timer),_g.timer=null},watch:{groupname:function(t){t&&(this.initData(),this.checkAppStatusData(),this.intervalGetPkgStatusHistory())},selectedAgentId:function(t){t&&(this.initData(),this.checkAppStatusData(),this.intervalGetPkgStatusHistory())}}},f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"pkgStatusHistoryTable",staticStyle:{width:"100%"},attrs:{data:t.pkgStatusHistoryTableList,"tooltip-effect":"dark","default-sort":{prop:"ts",order:"descending"},"header-cell-style":{background:"#fafafa",color:"#606266"}},on:{"selection-change":t.selectItem,"filter-change":t.filterStatus}},[n("el-table-column",{attrs:{type:"selection","min-width":"50",selectable:t.checkSelectable}}),t._v(" "),n("el-table-column",{attrs:{prop:"devname",label:t.$t("winPkgControl.deviceName"),"min-width":"120"}}),t._v(" "),t.statusType==t.batchWinPkgType?n("el-table-column",{attrs:{prop:"taskname",label:t.$t("winPkgControl.taskName"),"min-width":"120"}}):t._e(),t._v(" "),n("el-table-column",{attrs:{prop:"pkgname",label:t.$t("winPkgControl.projectName"),"min-width":"140"}}),t._v(" "),n("el-table-column",{attrs:{prop:"versionname",label:t.$t("winPkgControl.version"),"min-width":"100"}}),t._v(" "),n("el-table-column",{attrs:{label:t.$t("winPkgControl.beginTime"),"min-width":"130",prop:"ts"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("time")(e.row.ts))+"\n            ")]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"target",label:t.$t("winPkgControl.function"),"min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("appStatusFunction")(e.row.target))+"\n            ")]}}])}),t._v(" "),n("el-table-column",{attrs:{"column-key":"status",prop:"status",label:t.$t("winPkgControl.installStatus"),"min-width":"140",filters:[{text:t.$t("global.success"),value:2},{text:t.$t("global.failed"),value:1},{text:t.$t("global.running"),value:0}],"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.status?n("img",{staticStyle:{width:"50px",height:"10px"},attrs:{src:a("PLes"),alt:""}}):t._e(),t._v(" "),2==e.row.status?n("span",{staticClass:"badge bg-green"},[t._v(t._s(t.$t("global.success")))]):t._e(),t._v(" "),1==e.row.status?n("span",{staticClass:"badge bg-DimGray"},[t._v(t._s(t.$t("global.failed")))]):t._e()]}}])}),t._v(" "),n("el-table-column",{attrs:{label:t.$t("winPkgControl.errorStatus"),"min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("appErrorStatus")(""+e.row.errorcode))+"\n            ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:t.$t("winPkgControl.action"),"min-width":"175",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",[n("el-button-group",[n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){t.deleteHistory(e.row.aisid)}}},[t._v("\n                                "+t._s(t.$t("global.delete"))+"\n                        ")]),t._v(" "),n("el-button",{attrs:{size:"mini",type:"primary",disabled:1!=e.row.status},on:{click:function(a){t.reinstall(e.row)}}},[t._v("\n                                "+t._s(t.$t("winPkgControl.repeat"))+"\n                        ")])],1)],1)]}}])})],1),t._v(" "),n("btn-group",{directives:[{name:"show",rawName:"v-show",value:t.isShowBtnGroup,expression:"isShowBtnGroup"}],staticClass:"fl m-t-10 cf",attrs:{selectedData:t.multipleSelection,isDelete:!0,isMove:!1,tid:"aisid",delApi:t.batchDeleteAppStatusHistory},on:{result:t.isSuccess}}),t._v(" "),n("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.clearLoading,expression:"clearLoading"},{name:"show",rawName:"v-show",value:t.isShowBtnGroup,expression:"isShowBtnGroup"}],staticClass:"fl m-t-10 cf m-l-10",attrs:{size:"small",type:"primary"},on:{click:function(e){t.clearAll()}}},[t._v("\n    "+t._s(t.$t("winPkgControl.clearAll"))+"\n    ")]),t._v(" "),n("div",{staticClass:"m-t-10 cf fr"},[n("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.isshow,expression:"isshow"}],attrs:{layout:"prev, pager, next","page-size":t.limit,"current-page":t.currentPage,total:t.dataCount,background:""},on:{"current-change":t.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var m=a("C7Lr")(h,f,!1,function(t){a("a33h")},"data-v-936758aa",null).exports,v={name:"singlewinPkgControl",data:function(){return{activeName:"winMarket",pkgTableData:[],exeTableData:[],defaultImg:'this.src="static/imgs/default_windows.png"',singleWinPkgType:d.K,listLoading:!1,keywords:"",zipKeywords:""}},props:{selectedAgentId:{type:String,default:""},isSingleMode:{type:Boolean,default:!0},isOffline:{type:Boolean,default:!1}},components:{pkgHistory:m},methods:{getSensorStatus:function(){var t=this;this.isSingleMode?""!=this.selectedAgentId?(this.listLoading=!0,Object(r.e)(this.selectedAgentId,o.m.getExeInfo).then(function(e){var a=[],n=[];t.listLoading=!1,Object(l.a)(e,function(e){if("CONTENT"==e.status){if(e.content.value){var i=JSON.parse(e.content.value);"[object Array]"===Object.prototype.toString.call(i)&&i.length>0&&i.forEach(function(t){var e={type:"uninstall",filename:"",projectname:t.projectname,tool:"",version:t.version,address:"",reid:""};a.push(e),n.push(e)})}t.getRepoPkgs(a,n,d.S)}})}),Object(r.e)(this.selectedAgentId,o.m.getPkgInfo).then(function(e){var a=[],n=[];t.listLoading=!1,Object(l.a)(e,function(e){if("CONTENT"==e.status){var i=JSON.parse(e.content.value);"[object Array]"===Object.prototype.toString.call(i)&&i.length>0&&i.forEach(function(t){var e={type:"uninstall",filename:t.pkgname,projectname:t.appname,tool:"",version:t.version,address:"",reid:""};a.push(e),n.push(e)}),t.getRepoPkgs(a,n,d.T)}})})):console.error("selectAgentId is empty"):console.error("Cannot operate in a batch mode")},removeObjInArray:function(t,e,a){var n=!1;return"[object Array]"===Object.prototype.toString.call(t)?t.forEach(function(i,s){i.projectname===e&&i.version===a&&(t.splice(s,1),n=!0)}):console.error("data is not array"),n},getRepoPkgs:function(t,e,a){var n=this;if("[object Array]"==Object.prototype.toString.call(t)&&"[object Array]"==Object.prototype.toString.call(e)){var i={},s={};this.listLoading=!0,Object(c.a)(a).then(function(o){n.listLoading=!1,Object(l.a)(o,function(o){if("success"===o.status){"[object Array]"===Object.prototype.toString.call(o.data)&&o.data.forEach(function(o){i={type:"install",filename:o.filename,projectname:o.projectname,tool:o.tool,version:o.version,address:o.address,reid:o.reid},t.push(i),e.forEach(function(i,l){(a==d.S&&-1!=i.projectname.indexOf(o.projectname)||a==d.T&&i.projectname==o.projectname)&&(t.pop(),e[l].address=o.address,e[l].tool=o.tool,n.removeObjInArray(t,i.projectname,i.version)&&t.push(i),_g.cpr_version(o.version,i.version)&&(s={type:"upgrade",filename:o.filename,projectname:o.projectname,tool:o.tool,productname:i.projectname,version:o.version,address:o.address,reid:o.reid},t.push(s)))})})}a==d.S&&(n.exeTableData=t.reverse()),a==d.T&&(n.pkgTableData=t.reverse())})})}else console.error("getRepoPkgs　parameter is not array")},filterType:function(t,e){return e.type===t},actionAppSensor:function(t,e){var a=this;void 0!==o.m[t]?this.selectedAgentId?_g.swalWarnDo(this.$t("global.areYouSure"),this.$t("winPkgControl."+t),this.$t("global.confirm"),this.$t("global.cancel")).then(function(n){n&&(_g.openGlobalLoading(),Object(r.b)(a.selectedAgentId,o.m[t],e).then(function(t){Object(l.a)(t,function(t){"CHANGED"==t.status?(a.activeName="pkgStatusHistory",a.$refs.pkgHistory.intervalGetPkgStatusHistory()):_g.handleError(t)})}))}):this.$swal("",this.$t("global.selectDevice"),"info",{button:this.$t("global.confirm")}):this.$swal("",this.$t("global.functionNotSupport"),"info",{button:this.$t("global.confirm")})},setAppSensor:function(t,e){var a=this;void 0!==o.m[t]?e?""!=this.selectedAgentId?_g.swalWarnDo(this.$t("global.areYouSure"),this.$t("winPkgControl."+t),this.$t("global.confirm"),this.$t("global.cancel")).then(function(n){n&&(_g.openGlobalLoading(),Object(r.h)(a.selectedAgentId,o.m[t],e).then(function(t){Object(l.a)(t,function(t){"CHANGED"==t.status?a.$swal("",a.$t("global.success"),"success",{button:a.$t("global.confirm")}).then(function(){a.getSensorStatus()}):_g.handleError(t)})}))}):this.$swal("",this.$t("global.selectDevice"),"info",{button:this.$t("global.confirm")}):console.error("setSensorVal is null"):this.$swal("",this.$t("global.functionNotSupport"),"info",{button:this.$t("global.confirm")})},isFinished:function(){this.selectedAgentId&&(this.isOffline||this.getSensorStatus())},appAction:function(t,e){var a=void 0,n=void 0;"upgradeExe"===t?(a=e.address+"/"+e.filename,n=e.productname):(a=e.address+"/"+e.filename,n=e.projectname);var i={taskname:this.singleWinPkgType+(new Date).getTime(),projectname:n,tool:e.tool,version:e.version,downloadpath:a};this.actionAppSensor(t,i)},getSrc:function(t){return t?Object(p.d)()+"/getExeIcon/"+t:"static/imgs/default_windows.png"},initData:function(){this.startApp="",this.stopApp="",this.enableApp="",this.disableApp="",this.pkgTableData=[]},handleClick:function(t){"pkgStatusHistory"===t.name?this.$emit("isDisabled",!1):this.$emit("isDisabled",!0)}},watch:{isSingleMode:function(t){t&&this.initData()},selectedAgentId:function(t){this.isSingleMode&&(this.initData(),t&&!this.isOffline&&this.getSensorStatus())},activeName:function(){this.keywords=""}},computed:{isShowSearchInput:function(){return"winMarket"===this.activeName||"zipMarket"===this.activeName}}},b={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.isSingleMode,expression:"isSingleMode"}],staticClass:"p-r"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowSearchInput,expression:"isShowSearchInput"}],staticClass:"search"},[n("el-input",{staticClass:"w-250 m-l-10",attrs:{size:"small",placeholder:t.$t("winPkgControl.keywordHolder")},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}}),t._v(" "),n("i",{staticClass:"fa fa-search search-icon",attrs:{"aria-hidden":"true"}})],1),t._v(" "),n("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("el-tab-pane",{attrs:{name:"winMarket"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"fa fa-sellsy m-r-5",attrs:{"aria-hidden":"listLoading"}}),t._v("\n                "+t._s(t.$t("winPkgControl.exePkgMarket"))+"\n            ")]),t._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.exeTableData.filter(function(e){return!t.keywords||e.projectname.toLowerCase().includes(t.keywords.toLowerCase())}),"tooltip-effect":"dark","header-cell-style":{background:"#fafafa",color:"#606266"}}},[n("el-table-column",{attrs:{label:"",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",[n("img",{staticStyle:{width:"52px"},attrs:{src:t.getSrc(e.row.reid),onerror:t.defaultImg,alt:"no img"}})])]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"projectname",label:t.$t("winPkgControl.projectName"),"min-width":"120",sortable:""}}),t._v(" "),n("el-table-column",{attrs:{prop:"version",label:t.$t("winPkgControl.version"),"min-width":"120",sortable:""}}),t._v(" "),n("el-table-column",{attrs:{prop:"type",label:t.$t("winPkgControl.action"),"min-width":"120",filters:[{text:t.$t("winPkgControl.uninstall"),value:"uninstall"},{text:t.$t("winPkgControl.install"),value:"install"},{text:t.$t("winPkgControl.upgrade"),value:"upgrade"}],"filter-method":t.filterType,"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",[n("span",[n("el-button-group",["uninstall"===e.row.type?n("el-button",{attrs:{size:"small",type:"danger",disabled:"uninstall"===e.row.type&&!e.row.tool},on:{click:function(a){t.appAction("uninstallExe",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.uninstall"))+"\n                                    ")]):t._e(),t._v(" "),"upgrade"===e.row.type?n("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(a){t.appAction("upgradeExe",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.upgrade"))+"\n                                    ")]):t._e(),t._v(" "),"install"===e.row.type?n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){t.appAction("installExe",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.install"))+"\n                                    ")]):t._e()],1)],1)])]}}])})],1)],1),t._v(" "),n("el-tab-pane",{attrs:{name:"zipMarket"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"fa fa-sellsy m-r-5",attrs:{"aria-hidden":"listLoading"}}),t._v("\n                "+t._s(t.$t("winPkgControl.compressedPkgMarket"))+"\n            ")]),t._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.pkgTableData.filter(function(e){return!t.keywords||e.projectname.toLowerCase().includes(t.keywords.toLowerCase())}),"tooltip-effect":"dark","header-cell-style":{background:"#fafafa",color:"#606266"}}},[n("el-table-column",{attrs:{label:"",width:"100"},scopedSlots:t._u([{key:"default",fn:function(t){return[n("div",[n("img",{staticStyle:{width:"48px"},attrs:{src:a("yySc"),alt:"no img"}})])]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"filename",label:t.$t("linuxPkgControl.fileName"),"min-width":"120"}}),t._v(" "),n("el-table-column",{attrs:{prop:"projectname",label:t.$t("winPkgControl.projectName"),"min-width":"120",sortable:""}}),t._v(" "),n("el-table-column",{attrs:{prop:"version",label:t.$t("winPkgControl.version"),"min-width":"120",sortable:""}}),t._v(" "),n("el-table-column",{attrs:{prop:"type",label:t.$t("winPkgControl.action"),"min-width":"120",filters:[{text:t.$t("winPkgControl.uninstall"),value:"uninstall"},{text:t.$t("winPkgControl.install"),value:"install"},{text:t.$t("winPkgControl.upgrade"),value:"upgrade"}],"filter-method":t.filterType,"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",[n("span",[n("el-button-group",["uninstall"===e.row.type?n("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(a){t.appAction("uninstallPkg",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.uninstall"))+"\n                                    ")]):t._e(),t._v(" "),"upgrade"===e.row.type?n("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(a){t.appAction("upgradePkg",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.upgrade"))+"\n                                    ")]):t._e(),t._v(" "),"install"===e.row.type?n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){t.appAction("installPkg",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.install"))+"\n                                    ")]):t._e()],1)],1)])]}}])})],1)],1),t._v(" "),n("el-tab-pane",{attrs:{name:"pkgStatusHistory"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"fa fa-history m-r-5",attrs:{"aria-hidden":"true"}}),t._v("\n                "+t._s(t.$t("winPkgControl.winManagerHistory"))+"\n            ")]),t._v(" "),n("pkg-history",{ref:"pkgHistory",attrs:{statusType:t.singleWinPkgType,selectedAgentId:t.selectedAgentId},on:{isFinished:t.isFinished}})],1)],1)],1)},staticRenderFns:[]};var w=a("C7Lr")(v,b,!1,function(t){a("lVEa")},"data-v-6c7f1d30",null).exports,k=(a("0R+1"),{name:"batchwinPkgControl",data:function(){var t=this;return{activeName:"winMarket",pkgTableData:[],exeTableData:[],defaultImg:'this.src="static/imgs/default_windows.png"',dialogTasknameVisible:!1,projectname:"",version:"",address:"",tool:"",filename:"",pkgStatusForm:{taskname:""},rules:{taskname:{required:!0,validator:function(e,a,n){if(!new RegExp(/^(?![._-\s])[\u4E00-\u9FA5A-Za-z0-9_\-\.\s]{1,12}$/).test(a))return n(new Error(t.$t("global.verifyShortError")));n()},trigger:"blur"}},batchWinPkgType:d.l,cid:"",disableAppArray:d.o,isShowOverview:!1,win_taskname:"",success:0,installing:0,failed:0,listLoading:!1,keywords:"",zipKeywords:""}},props:{selectedAgentsData:{type:Array,default:[]},groupname:{type:String,default:""},isSingleMode:{type:Boolean,default:!0}},components:{pkgHistory:m},methods:{filterType:function(t,e){return e.type===t},getSensorStatus:function(){var t=this;this.isSingleMode?console.error("Cannot operate in a single mode"):0!=this.selectedAgentsData.length?(this.listLoading=!0,Object(r.e)(this.selectedAgentsData[0].value,o.m.getExeInfo).then(function(e){var a=[],n=[];t.listLoading=!1,Object(l.a)(e,function(e){if("CONTENT"==e.status){if(e.content.value){var i=JSON.parse(e.content.value);"[object Array]"===Object.prototype.toString.call(i)&&i.length>0&&i.forEach(function(t){var e={type:"uninstall",filename:"",projectname:t.projectname,tool:"",version:t.version,address:"",reid:""};a.push(e),n.push(e)})}t.getRepoPkgs(a,n,d.S)}})}),Object(r.e)(this.selectedAgentsData[0].value,o.m.getPkgInfo).then(function(e){var a=[],n=[];t.listLoading=!1,Object(l.a)(e,function(e){if("CONTENT"==e.status){var i=JSON.parse(e.content.value);"[object Array]"===Object.prototype.toString.call(i)&&i.length>0&&i.forEach(function(t){var e={type:"uninstall",filename:t.pkgname,projectname:t.appname,tool:"",version:t.version,address:"",reid:""};a.push(e),n.push(e)}),t.getRepoPkgs(a,n,d.T)}})})):console.error("getSensorStatus: agentData is null")},removeObjInArray:function(t,e,a){var n=!1;return"[object Array]"===Object.prototype.toString.call(t)?t.forEach(function(i,s){i.projectname===e&&i.version===a&&(t.splice(s,1),n=!0)}):console.error("data is not array"),n},getRepoPkgs:function(t,e,a){var n=this;if("[object Array]"==Object.prototype.toString.call(t)&&"[object Array]"==Object.prototype.toString.call(e)){var i={},s={};this.listLoading=!0,Object(c.a)(a).then(function(o){n.listLoading=!1,Object(l.a)(o,function(o){if("success"===o.status){"[object Array]"===Object.prototype.toString.call(o.data)&&o.data.forEach(function(o){i={type:"install",filename:o.filename,projectname:o.projectname,tool:o.tool,version:o.version,address:o.address,reid:o.reid},t.push(i),console.log(e),e.forEach(function(i,l){(a==d.S&&-1!=i.projectname.indexOf(o.projectname)||a==d.T&&i.projectname==o.projectname)&&(t.pop(),console.log(t),e[l].address=o.address,e[l].tool=o.tool,n.removeObjInArray(t,i.projectname,i.version)&&t.push(i),_g.cpr_version(o.version,i.version)&&(s={type:"upgrade",filename:o.filename,projectname:o.projectname,productname:i.projectname,version:o.version,tool:o.tool,address:o.address,reid:o.reid},t.push(s)))})})}a==d.S&&(n.exeTableData=t.reverse()),a==d.T&&(n.pkgTableData=t.reverse())})})}else console.error("getRepoPkgs　parameter is not array")},batchSetAppSensor:function(t,e){var a=this;if(void 0!==o.m[t]){_g.openGlobalLoading();var n={groupname:this.groupname,taskname:this.pkgStatusForm.taskname,projectname:this.projectname,tool:this.tool,version:this.version,downloadpath:e},i=this.pkgStatusForm.taskname;this.dialogTasknameVisible=!1,Object(r.a)(o.m[t],n).then(function(t){Object(l.a)(t,function(t){"CHANGED"==t.status?(Object(u.f)("win_taskname",i),a.activeName="winStatusHistory",a.$refs.pkgHistory.intervalGetPkgStatusHistory()):_g.handleError(t)})})}else this.$swal("",this.$t("global.functionNotSupport"),"info",{button:this.$t("global.confirm")})},batchinstallPkg:function(){var t=this;0!==this.selectedAgentsData.length?this.$refs.pkgStatusForm.validate(function(e){if(e){var a=t.address+"/"+t.filename;t.batchSetAppSensor(t.cid,a)}}):this.$swal("",this.$t("global.devicesOffline"),"info",{button:this.$t("global.confirm")})},selectBatchinstallPkg:function(t,e){this.cid=t,this.address=e.address,this.projectname="upgradeExe"==t?e.productname:e.projectname,this.tool=e.tool,this.filename=e.filename,this.version=e.version,this.pkgStatusForm.taskname="",this.dialogTasknameVisible=!0},initPkgInfo:function(){this.projectname="",this.version="",this.address="",this.pkgStatusForm.taskname="",this.cid="",this.tool="",this.filename=""},getBatchAppStatusCount:function(){var t=this,e=Object(u.c)("win_taskname");if(!e)return console.error("getBatchAppStatusCount:localStorage(win_taskname) is null"),void(this.isShowOverview=!1);Object(g.k)(e,d.l).then(function(a){Object(l.a)(a,function(a){a&&(t.win_taskname=e,t.installing=a.installing,t.failed=a.fail,t.success=a.success,t.total>0&&"winStatusHistory"===t.activeName?t.isShowOverview=!0:t.isShowOverview=!1)})})},initData:function(){this.pkgTableData=[]},getSrc:function(t){return t?Object(p.d)()+"/getExeIcon/"+t:"static/imgs/default_windows.png"},handleClick:function(t){"winStatusHistory"===t.name?this.getBatchAppStatusCount():this.isShowOverview=!1},isFinished:function(){this.getSensorStatus()}},computed:{isShowSearchInput:function(){return"winMarket"===this.activeName||"zipMarket"===this.activeName},total:function(){return this.success+this.installing+this.failed}},watch:{isSingleMode:function(t){t||this.initData()},groupname:function(t){!this.isSingleMode&&t&&(this.initData(),this.getSensorStatus())},activeName:function(){this.keywords=""}}}),y={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:!t.isSingleMode,expression:"!isSingleMode"}],staticClass:"pkgStatusContent p-r"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowSearchInput,expression:"isShowSearchInput"}],staticClass:"search"},[n("el-input",{staticClass:"w-250 m-l-10",attrs:{size:"small",placeholder:t.$t("winPkgControl.keywordHolder")},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}}),t._v(" "),n("i",{staticClass:"fa fa-search search-icon",attrs:{"aria-hidden":"true"}})],1),t._v(" "),n("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[n("el-tab-pane",{attrs:{name:"winMarket"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"fa fa-sellsy m-r-5",attrs:{"aria-hidden":"true"}}),t._v("\n                "+t._s(t.$t("winPkgControl.exePkgMarket"))+"\n            ")]),t._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.exeTableData.filter(function(e){return!t.keywords||e.projectname.toLowerCase().includes(t.keywords.toLowerCase())}),"tooltip-effect":"dark","header-cell-style":{background:"#fafafa",color:"#606266"}}},[n("el-table-column",{attrs:{label:"",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",[n("img",{staticStyle:{width:"52px"},attrs:{src:t.getSrc(e.row.reid),onerror:t.defaultImg,alt:"no img"}})])]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"projectname",label:t.$t("winPkgControl.projectName"),"min-width":"120",sortable:""}}),t._v(" "),n("el-table-column",{attrs:{prop:"version",label:t.$t("winPkgControl.version"),"min-width":"120",sortable:""}}),t._v(" "),n("el-table-column",{attrs:{prop:"type",label:t.$t("winPkgControl.action"),"min-width":"120",filters:[{text:t.$t("winPkgControl.uninstall"),value:"uninstall"},{text:t.$t("winPkgControl.install"),value:"install"},{text:t.$t("winPkgControl.upgrade"),value:"upgrade"}],"filter-method":t.filterType,"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",[n("span",[n("el-button-group",["uninstall"===e.row.type?n("el-button",{attrs:{size:"small",type:"danger",disabled:"uninstall"===e.row.type&&!e.row.tool},on:{click:function(a){t.selectBatchinstallPkg("uninstallExe",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.uninstall"))+"\n                                    ")]):t._e(),t._v(" "),"upgrade"===e.row.type?n("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(a){t.selectBatchinstallPkg("upgradeExe",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.upgrade"))+"\n                                    ")]):t._e(),t._v(" "),"install"===e.row.type?n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){t.selectBatchinstallPkg("installExe",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.install"))+"\n                                    ")]):t._e()],1)],1)])]}}])})],1)],1),t._v(" "),n("el-tab-pane",{attrs:{name:"zipMarket"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"fa fa-sellsy m-r-5",attrs:{"aria-hidden":"listLoading"}}),t._v("\n                "+t._s(t.$t("winPkgControl.compressedPkgMarket"))+"\n            ")]),t._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.pkgTableData.filter(function(e){return!t.keywords||e.projectname.toLowerCase().includes(t.keywords.toLowerCase())}),"tooltip-effect":"dark","header-cell-style":{background:"#fafafa",color:"#606266"}}},[n("el-table-column",{attrs:{label:"",width:"100"},scopedSlots:t._u([{key:"default",fn:function(t){return[n("div",[n("img",{staticStyle:{width:"48px"},attrs:{src:a("yySc"),alt:"no img"}})])]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"filename",label:t.$t("linuxPkgControl.fileName"),"min-width":"120"}}),t._v(" "),n("el-table-column",{attrs:{prop:"projectname",label:t.$t("winPkgControl.projectName"),"min-width":"120",sortable:""}}),t._v(" "),n("el-table-column",{attrs:{prop:"version",label:t.$t("winPkgControl.version"),"min-width":"120",sortable:""}}),t._v(" "),n("el-table-column",{attrs:{prop:"type",label:t.$t("winPkgControl.action"),"min-width":"120",filters:[{text:t.$t("winPkgControl.uninstall"),value:"uninstall"},{text:t.$t("winPkgControl.install"),value:"install"},{text:t.$t("winPkgControl.upgrade"),value:"upgrade"}],"filter-method":t.filterType,"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",[n("span",[n("el-button-group",["uninstall"===e.row.type?n("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(a){t.selectBatchinstallPkg("uninstallPkg",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.uninstall"))+"\n                                    ")]):t._e(),t._v(" "),"upgrade"===e.row.type?n("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(a){t.selectBatchinstallPkg("upgradePkg",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.upgrade"))+"\n                                    ")]):t._e(),t._v(" "),"install"===e.row.type?n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){t.selectBatchinstallPkg("installPkg",e.row)}}},[t._v("\n                                        "+t._s(t.$t("winPkgControl.install"))+"\n                                    ")]):t._e()],1)],1)])]}}])})],1)],1),t._v(" "),n("el-tab-pane",{attrs:{name:"winStatusHistory"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"fa fa-history m-r-5",attrs:{"aria-hidden":"true"}}),t._v("\n                "+t._s(t.$t("winPkgControl.winManagerHistory"))+"\n            ")]),t._v(" "),n("pkg-history",{ref:"pkgHistory",attrs:{statusType:t.batchWinPkgType,groupname:t.groupname},on:{getStatusCount:t.getBatchAppStatusCount,isFinished:t.isFinished}})],1)],1),t._v(" "),n("el-dialog",{attrs:{visible:t.dialogTasknameVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogTasknameVisible=e},close:function(e){t.initPkgInfo()}}},[n("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[n("i",{staticClass:"fa fa-level-up m-r-10"}),t._v("\n            "+t._s(t.$t("winPkgControl.batchInstallPkg"))+"\n        ")]),t._v(" "),n("el-form",{ref:"pkgStatusForm",attrs:{model:t.pkgStatusForm,rules:t.rules}},[n("el-form-item",{attrs:{label:t.$t("label.taskName"),"label-width":"230px",prop:"taskname"}},[n("el-input",{staticClass:"max-w-350",attrs:{autocomplete:"off",placeholder:t.$t("winPkgControl.installPkgTaskName")},model:{value:t.pkgStatusForm.taskname,callback:function(e){t.$set(t.pkgStatusForm,"taskname","string"==typeof e?e.trim():e)},expression:"pkgStatusForm.taskname"}})],1)],1),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.dialogTasknameVisible=!1}}},[t._v(t._s(t.$t("global.cancel")))]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(e){t.batchinstallPkg()}}},[t._v(t._s(t.$t("global.confirm")))])],1)],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowOverview,expression:"isShowOverview"}],staticClass:"appStatusCount"},[n("span",[t._v(t._s(t.$t("label.taskName"))+" "+t._s(t.win_taskname))]),t._v(" "),n("span",[t._v(t._s(t.$t("winPkgControl.total"))+" "+t._s(t.total))]),t._v(" "),n("span",[t._v(t._s(t.$t("winPkgControl.deploying"))+" "+t._s(t.installing))]),t._v(" "),n("span",[t._v(t._s(t.$t("winPkgControl.success"))+" "+t._s(t.success))]),t._v(" "),n("span",[t._v(t._s(t.$t("winPkgControl.failed"))+" "+t._s(t.failed))])])],1)},staticRenderFns:[]};var _=a("C7Lr")(k,y,!1,function(t){a("rpV+")},"data-v-60a05842",null).exports,S={name:"controlAppcontrol",data:function(){return{selectedAgentId:"",selectedAgentsData:[],isSingleMode:!0,groupname:"",isDisabledOffDev:!0,isOffline:!1,groupType:d.u.windows,groupTypeArray:[d.u.windows]}},components:{selectDevice:n.a,selectGroup:s.a,modeSwitch:i.a,singleControl:w,batchControl:_},methods:{getDeviceOption:function(t){this.selectedAgentId=t},getGroupOption:function(t){this.selectedAgentsData=t},initData:function(){this.selectedAgentId="",this.groupname="",this.selectedAgentsData=[]},changeMode:function(t){this.initData(),this.isSingleMode=!t},getGroupName:function(t){this.groupname=t},isDisabled:function(t){this.isDisabledOffDev=t},isOfflineDev:function(t){this.isOffline=t}}},C={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content-box"},[a("div",{staticClass:"title-box"},[a("p",{staticClass:"header-line"},[a("i",{staticClass:"fa fa-sliders m-r-10"}),t._v("\n            "+t._s(t.$t("winPkgControl.pkgDeploy"))+"\n            \n        ")])]),t._v(" "),a("div",{staticClass:"select-box"},[a("mode-switch",{on:{"mode-status":t.changeMode}}),t._v(" "),a("span",{staticClass:"vertical"}),t._v(" "),a("select-group",{attrs:{isSingleMode:t.isSingleMode,groupType:t.groupTypeArray},on:{"select-getDeviceOptions":t.getGroupOption,"select-getGroupName":t.getGroupName}}),t._v(" "),a("select-device",{attrs:{isSingleMode:t.isSingleMode,isDisabledOffDev:t.isDisabledOffDev,groupType:t.groupType},on:{"select-device":t.getDeviceOption,isOfflineDev:t.isOfflineDev}}),t._v(" "),a("p",{staticClass:"note"},[a("i",[t._v(t._s(t.$t("winPkgControl.note")))]),t._v("\n            "+t._s(t.$t("winPkgControl.noteContent"))+"\n        ")])],1),t._v(" "),a("div",{staticClass:"table-box"},[a("single-control",{attrs:{selectedAgentId:t.selectedAgentId,isSingleMode:t.isSingleMode,isOffline:t.isOffline},on:{isDisabled:t.isDisabled}}),t._v(" "),a("batch-control",{attrs:{selectedAgentsData:t.selectedAgentsData,isSingleMode:t.isSingleMode,groupname:t.groupname}})],1)])},staticRenderFns:[]};var $=a("C7Lr")(S,C,!1,function(t){a("l5iW")},"data-v-7bc30d1a",null);e.default=$.exports}});
//# sourceMappingURL=12.3ef1b17e77bc4cd4d3dd.js.map