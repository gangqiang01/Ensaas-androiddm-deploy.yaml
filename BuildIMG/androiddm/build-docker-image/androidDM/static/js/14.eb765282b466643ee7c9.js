webpackJsonp([14],{F0oJ:function(t,e){},F1P2:function(t,e){},QO1B:function(t,e){},"X/OW":function(t,e){},puMI:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("42+z"),i=a("FM1y"),n=a("HvBW"),o=a("jwu5"),l=a("/eZD"),r=a("jnx8"),p=a("YMj5"),c=a("0R+1"),u=a("22O3"),d=a("OT2R"),h=a("UuJD"),g={name:"appcontrolHistory",data:function(){return{appStatusHistoryTableList:[],isshow:!1,limit:10,dataCount:0,currentPage:1,multipleSelection:[],isShowBtnGroup:!1,clearLoading:!1,batchDeleteAppStatusHistory:h.a,intervalTime:7e3,isInterval:!1,listLoading:!1,singleInstallType:l.I,batchInstallType:l.k,statusArray:[]}},components:{btnGroup:a("C+p8").a},props:{statusType:{default:l.k,type:String},selectedAgentId:{default:"",type:String},groupname:{default:"",type:String}},methods:{selectItem:function(t){this.multipleSelection=t},checkSelectable:function(t){return 0==!t.status},handleCurrentChange:function(t){this.currentPage=t||1,this.intervalGetAppStatusHistory()},deleteHistory:function(t){var e=this;_g.swalInfoDo(this.$t("global.areYouSure"),this.$t("global.delete"),this.$t("global.confirm"),this.$t("global.cancel")).then(function(a){a&&(e.listLoading=!0,Object(h.d)(t).then(function(t){e.listLoading=!1,Object(r.a)(t,function(t){"CHANGED"===t.status?e.$swal("",e.$t("global.success"),"success",{button:e.$t("global.confirm")}).then(function(){e.intervalGetAppStatusHistory()}):_g.handleError(t)})}))})},checkAppStatusData:function(){this.statusType==l.k?Object(h.f)(this.groupname,this.statusType):Object(h.e)(this.selectedAgentId,this.statusType)},getAppStatusHistoryByGroupname:function(){var t=this;this.groupname||console.error("[getAppStatusHistoryByGroupname]groupname is empty"),!1===this.isInterval&&(this.listLoading=!0),this.statusArray.length>0?Object(h.h)(this.groupname,this.statusType,this.currentPage,this.limit,this.statusArray).then(function(e){t.listLoading=!1,Object(r.a)(e,function(e){t.assignAppStatusData(e)})}):Object(h.j)(this.groupname,this.statusType,this.currentPage,this.limit).then(function(e){t.listLoading=!1,Object(r.a)(e,function(e){t.assignAppStatusData(e)})})},getAppStatusHistoryByDevid:function(){var t=this;this.selectedAgentId||console.error("[getAppStatusHistoryByDevid]selectedAgentId is empty"),!1===this.isInterval&&(this.listLoading=!0),this.statusArray.length>0?Object(h.g)(this.selectedAgentId,this.statusType,this.currentPage,this.limit,this.statusArray).then(function(e){t.listLoading=!1,Object(r.a)(e,function(e){t.assignAppStatusData(e)})}):Object(h.i)(this.selectedAgentId,this.statusType,this.currentPage,this.limit).then(function(e){t.listLoading=!1,Object(r.a)(e,function(e){t.assignAppStatusData(e)})})},assignAppStatusData:function(t){if("[object Object]"===Object.prototype.toString.call(t)&&"[object Array]"===Object.prototype.toString.call(t.data)){this.dataCount=t.count,this.appStatusHistoryTableList=t.data,this.isshow=this.dataCount>this.limit,this.isShowBtnGroup=this.dataCount>0;var e=!0;this.statusType==l.k&&this.$emit("getStatusCount"),t.data.forEach(function(t){0==t.status&&(e=!1)}),e&&(this.$emit("isFinished"),window.clearInterval(_g.timer),_g.timer=null)}else window.clearInterval(_g.timer),_g.timer=null},intervalGetAppStatusHistory:function(){var t=this;this.statusType==l.k?(this.getAppStatusHistoryByGroupname(),null===_g.timer&&(_g.timer=window.setInterval(function(){t.getAppStatusHistoryByGroupname(),t.isInterval=!0},this.intervalTime))):(this.getAppStatusHistoryByDevid(),null===_g.timer&&(_g.timer=window.setInterval(function(){t.getAppStatusHistoryByDevid(),t.isInterval=!0},this.intervalTime)))},filterStatus:function(t){this.statusArray=t.status,this.currentPage=1,_g.isArray(this.statusArray)&&this.intervalGetAppStatusHistory()},resetAppSensor:function(t,e,a){var s=this;this.listLoading=!0,Object(p.g)(e,t,a).then(function(t){s.listLoading=!1,Object(r.a)(t,function(t){"CHANGED"==t.status?(s.activeName="appStatusHistory",s.currentPage=1,s.intervalGetAppStatusHistory()):_g.handleError(t)})})},reinstall:function(t){var e=this;_g.swalInfoDo(this.$t("global.areYouSure"),this.$t("appControl.reinstall"),this.$t("global.confirm"),this.$t("global.cancel")).then(function(a){if(a){var s={taskname:t.taskname,filename:t.filename,pkgname:t.pkgname,versioncode:t.versioncode,version:t.versionname,downloadpath:t.address};e.resetAppSensor(t.target,t.deviceId,s)}})},isSuccess:function(t){t&&this.intervalGetAppStatusHistory()},clearAll:function(){var t=this;_g.swalInfoDo(this.$t("global.areYouSure"),this.$t("global.clearAll"),this.$t("global.confirm"),this.$t("global.cancel")).then(function(e){e&&(t.clearLoading=!0,t.statusType==l.k?Object(h.c)(t.groupname,t.statusType).then(function(e){t.clearLoading=!1,Object(r.a)(e,function(e){"CHANGED"===e.status?t.$swal("",t.$t("global.success"),"success",{button:t.$t("global.confirm")}).then(function(){t.intervalGetAppStatusHistory()}):_g.handleError(e)})}):Object(h.b)(t.selectedAgentId,t.statusType).then(function(e){t.clearLoading=!1,Object(r.a)(e,function(e){"CHANGED"===e.status?t.$swal("",t.$t("global.success"),"success",{button:t.$t("global.confirm")}).then(function(){t.intervalGetAppStatusHistory()}):_g.handleError(e)})}))})},initData:function(){this.appStatusHistoryTableList=[],this.isShowBtnGroup=!1,this.isshow=!1,this.isInterval=!1,this.currentPage=1}},created:function(){this.statusType==l.k&&this.$emit("getStatusCount")},beforeDestroy:function(){window.clearInterval(_g.timer),_g.timer=null},watch:{groupname:function(t){t&&(this.initData(),this.checkAppStatusData(),this.intervalGetAppStatusHistory())},selectedAgentId:function(t){t&&(this.initData(),this.checkAppStatusData(),this.intervalGetAppStatusHistory())}}},f={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"appStatusHistoryTable",staticStyle:{width:"100%"},attrs:{data:t.appStatusHistoryTableList,"tooltip-effect":"dark","default-sort":{prop:"ts",order:"descending"}},on:{"selection-change":t.selectItem,"filter-change":t.filterStatus}},[s("el-table-column",{attrs:{type:"selection","min-width":"50",selectable:t.checkSelectable}}),t._v(" "),s("el-table-column",{attrs:{prop:"devname",label:t.$t("appControl.deviceName"),"min-width":"120"}}),t._v(" "),t.statusType==t.batchInstallType?s("el-table-column",{attrs:{prop:"taskname",label:t.$t("appControl.taskName"),"min-width":"120"}}):t._e(),t._v(" "),s("el-table-column",{attrs:{prop:"filename",label:t.$t("appControl.apkName"),"min-width":"140"}}),t._v(" "),s("el-table-column",{attrs:{prop:"versionname",label:t.$t("appControl.versionName"),"min-width":"105"}}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("appControl.beginTime"),"min-width":"130",prop:"ts"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("time")(e.row.ts))+"\n            ")]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"target",label:t.$t("appControl.function"),"min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("appStatusFunction")(e.row.target))+"\n            ")]}}])}),t._v(" "),s("el-table-column",{attrs:{"column-key":"status",prop:"status",label:t.$t("appControl.installStatus"),"min-width":"140",filters:[{text:t.$t("global.success"),value:2},{text:t.$t("global.failed"),value:1},{text:t.$t("global.running"),value:0}],"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.status?s("img",{staticStyle:{width:"50px",height:"10px"},attrs:{src:a("PLes"),alt:""}}):t._e(),t._v(" "),2==e.row.status?s("span",{staticClass:"badge bg-green"},[t._v(t._s(t.$t("global.success")))]):t._e(),t._v(" "),1==e.row.status?s("span",{staticClass:"badge bg-DimGray"},[t._v(t._s(t.$t("global.failed")))]):t._e()]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("appControl.errorStatus"),"min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("appErrorStatus")(""+e.row.errorcode))+"\n            ")]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("appControl.action"),"min-width":"175",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",[s("el-button-group",[s("el-button",{attrs:{size:"mini",type:"danger",disabled:0==e.row.status},on:{click:function(a){t.deleteHistory(e.row.aisid)}}},[t._v("\n                                "+t._s(t.$t("global.delete"))+"\n                        ")]),t._v(" "),s("el-button",{attrs:{size:"mini",type:"primary",disabled:1!=e.row.status},on:{click:function(a){t.reinstall(e.row)}}},[t._v("\n                                "+t._s(t.$t("appControl.reinstall"))+"\n                        ")])],1)],1)]}}])})],1),t._v(" "),s("btn-group",{directives:[{name:"show",rawName:"v-show",value:t.isShowBtnGroup,expression:"isShowBtnGroup"}],staticClass:"fl m-t-10 cf",attrs:{selectedData:t.multipleSelection,isDelete:!0,isMove:!1,tid:"aisid",delApi:t.batchDeleteAppStatusHistory},on:{result:t.isSuccess}}),t._v(" "),s("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.clearLoading,expression:"clearLoading"},{name:"show",rawName:"v-show",value:t.isShowBtnGroup,expression:"isShowBtnGroup"}],staticClass:"fl m-t-10 cf m-l-10",attrs:{size:"small",type:"primary"},on:{click:function(e){t.clearAll()}}},[t._v("\n    "+t._s(t.$t("appControl.clearAll"))+"\n    ")]),t._v(" "),s("div",{staticClass:"m-t-10 cf fr"},[s("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.isshow,expression:"isshow"}],attrs:{layout:"prev, pager, next","page-size":t.limit,"current-page":t.currentPage,total:t.dataCount,background:""},on:{"current-change":t.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var m=a("C7Lr")(g,f,!1,function(t){a("F1P2")},"data-v-74c9a6df",null).exports,v=a("yeZF"),b={name:"singleAppcontrol",data:function(){return{activeName:"appMarket",startApp:"",stopApp:"",enableApp:"",disableApp:"",appTableData:[],appOptions:[],disableAppArray:l.o,appGroups:[{label:"Third Part",value:"third"},{label:"System",value:"system"}],defaultImg:'this.src="static/imgs/default_apk.png"',singleInstallType:l.I,appType:"uninstallApp",whitelist:!1,listLoading:!1,keywords:""}},props:{selectedAgentId:{type:String,default:""},isSingleMode:{type:Boolean,default:!0},isOffline:{type:Boolean,default:!1}},components:{appHistory:m,cardTemp:v.a},methods:{getSensorStatus:function(){var t=this;if(this.isSingleMode)if(""!=this.selectedAgentId){var e=[],a=[];this.listLoading=!0,Object(p.e)(this.selectedAgentId,o.c.getAllAppInfo).then(function(s){t.listLoading=!1,Object(r.a)(s,function(s){if("CONTENT"==s.status){if(s.content.value){var i=JSON.parse(s.content.value).data;t.appOptions=i,"[object Array]"===Object.prototype.toString.call(i)&&i.length>0&&i.forEach(function(t){var s={type:"uninstallApp",appname:t.appName,package:t.packageName,versioncode:t.versionCode,version:t.versionName,address:"",raid:"",isKioskApp:t.isKioskApp,inwhitelist:t.inWhiteList};"third"===t.type&&e.push(s),a.push(s)})}t.getRepoApps(e,a)}})})}else console.error("selectAgentId is empty");else console.error("Cannot operate in a batch mode")},removeObjInArray:function(t,e){"[object Array]"===Object.prototype.toString.call(t)?t.forEach(function(a,s){a.package===e&&t.splice(s,1)}):console.error("data is not array")},getRepoApps:function(t,e){var a=this;if("[object Array]"==Object.prototype.toString.call(t)&&"[object Array]"==Object.prototype.toString.call(e)){var s={},i={};this.listLoading=!0,Object(c.a)().then(function(n){a.listLoading=!1,Object(r.a)(n,function(n){if("success"===n.status){if("[object Array]"!==Object.prototype.toString.call(n.data))return void console.error("data is not array");n.data.forEach(function(a){null!=a.versionName&&a.versionName;s={type:"installApp",darkname:a.repo.darkname,appname:a.filename,package:a.pkgname,versioncode:a.versioncode,version:a.versionname,address:a.address,raid:a.raid,isKioskApp:"false",inwhitelist:"false"},t.push(s),e.forEach(function(s,n){a.pkgname===s.package&&(t.pop(),e[n].address=a.address,e[n].raid=a.raid,Number(a.versioncode)>Number(s.versioncode)&&(i={type:"upgradeApp",darkname:a.repo.darkname,appname:a.filename,package:a.pkgname,versioncode:a.versioncode,version:a.versionname,address:a.address,raid:a.raid,isKioskApp:"false",inwhitelist:"false"},t.push(i)))})})}a.appTableData=t.reverse()})})}else console.error("getRepoApps　parameter is not array")},filterType:function(t,e){return e.type===t},actionAppSensor:function(t,e){var a=this;void 0!==o.c[t]?this.selectedAgentId?_g.swalWarnDo(this.$t("global.areYouSure"),this.$t("appControl."+t),this.$t("global.confirm"),this.$t("global.cancel")).then(function(s){s&&(_g.openGlobalLoading(),Object(p.b)(a.selectedAgentId,o.c[t],e).then(function(t){Object(r.a)(t,function(t){"CHANGED"==t.status?(a.activeName="appStatusHistory",a.$refs.appHistory.intervalGetAppStatusHistory()):_g.handleError(t)})}))}):this.$swal("",this.$t("global.selectDevice"),"info",{button:this.$t("global.confirm")}):this.$swal("",this.$t("global.functionNotSupport"),"info",{button:this.$t("global.confirm")})},setAppSensor:function(t,e){var a=this;void 0!==o.c[t]?e&&(""!=this.selectedAgentId?"uninstallApp"===t||"disableApp"===t||"stopApp"===t?_g.swalWarnDo(this.$t("global.areYouSure"),this.$t("appControl."+t),this.$t("global.confirm"),this.$t("global.cancel")).then(function(s){s&&(_g.openGlobalLoading(),Object(p.h)(a.selectedAgentId,o.c[t],e).then(function(e){Object(r.a)(e,function(e){"CHANGED"==e.status?a.$swal("",a.$t("global.success"),"success",{button:a.$t("global.confirm")}).then(function(){"uninstallApp"===t&&a.getSensorStatus()}):_g.handleError(e)})}))}):(_g.openGlobalLoading(),Object(p.h)(this.selectedAgentId,o.c[t],e).then(function(e){Object(r.a)(e,function(e){"CHANGED"==e.status?a.$swal("",a.$t("global.success"),"success",{button:a.$t("global.confirm")}).then(function(){"setKiosk"!==t&&"cancelKiosk"!==t||a.getSensorStatus()}):_g.handleError(e)})})):this.$swal("",this.$t("global.selectDevice"),"info",{button:this.$t("global.confirm")})):this.$swal("",this.$t("global.functionNotSupport"),"info",{button:this.$t("global.confirm")})},isFinished:function(){this.selectedAgentId&&(this.isOffline||this.getSensorStatus())},appAction:function(t,e){var a=void 0,s=void 0;if("installApp"!==t&&"upgradeApp"!==t)return a=e.package,void this.setAppSensor(t,a);a=e.address,s=e.version;var i={taskname:this.singleInstallType+(new Date).getTime(),filename:e.appname,pkgname:e.package,versioncode:e.versioncode,version:s,downloadpath:a};this.actionAppSensor(t,i)},handleCommand:function(t){var e=t.id,a=void 0;a="system"===this.appType||"desktop"===this.appType?t.appInfo.packageName:t.appInfo.package,this.setAppSensor(e,a)},getSrc:function(t){return t?Object(d.d)()+"/getAppIcon/"+t:"static/imgs/default_apk.png"},initData:function(){this.startApp="",this.stopApp="",this.enableApp="",this.disableApp="",this.appTableData=[],this.appOptions=[]},handleClick:function(t){"appStatusHistory"===t.name?this.$emit("isDisabled",!1):this.$emit("isDisabled",!0)},getServerStatus:function(){var t=this;Object(p.e)(this.selectedAgentId,o.b.whitelist).then(function(e){Object(r.a)(e,function(e){if("CONTENT"===e.status){var a=e.content.value;t.whitelist="boolean"==typeof a?a:"true"===a||"false"===a?"true"===a:a}})})},disableOperation:function(){this.$swal("",this.$t("appControl.appNotInWhitelist"),"info",{button:this.$t("global.confirm")})}},watch:{isSingleMode:function(t){t&&this.initData()},selectedAgentId:function(t){this.isSingleMode&&(this.initData(),t&&!this.isOffline&&(this.getSensorStatus(),this.getServerStatus()))}},computed:{isShowSearchInput:function(){return"appMarket"===this.activeName}}},y={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:t.isSingleMode,expression:"isSingleMode"}],staticClass:"appStatusContent p-r"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowSearchInput,expression:"isShowSearchInput"}],staticClass:"search"},[a("el-input",{staticClass:"w-250 m-l-10",attrs:{size:"small",placeholder:t.$t("appControl.keywordHolder")},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}}),t._v(" "),a("i",{staticClass:"fa fa-search search-icon",attrs:{"aria-hidden":"true"}})],1),t._v(" "),a("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"appMarket"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-sellsy m-r-5",attrs:{"aria-hidden":"listLoading"}}),t._v("\n                "+t._s(t.$t("appControl.appMarket"))+"\n            ")]),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.appTableData.filter(function(e){return!t.keywords||e.appname.toLowerCase().includes(t.keywords.toLowerCase())}),"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:"",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[a("img",{staticStyle:{width:"52px"},attrs:{src:t.getSrc(e.row.raid),onerror:t.defaultImg,alt:"no img"}})])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"appname",label:t.$t("appControl.appName"),"min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"package",label:t.$t("appControl.packageName"),"min-width":"120",sortable:""}}),t._v(" "),a("el-table-column",{attrs:{prop:"version",label:t.$t("appControl.versionName"),"min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"type",label:t.$t("appControl.action"),"min-width":"120",filters:[{text:t.$t("appControl.uninstall"),value:"uninstallApp"},{text:t.$t("appControl.install"),value:"installApp"},{text:t.$t("appControl.upgrade"),value:"upgradeApp"}],"filter-method":t.filterType,"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[a("span",[a("el-button-group",["uninstallApp"===e.row.type?a("el-button",{attrs:{size:"small",type:"danger",disabled:t.disableAppArray.indexOf(e.row.package)>-1},on:{click:function(a){t.appAction("uninstallApp",e.row)}}},[t._v("\n                                        "+t._s(t.$t("appControl.uninstall"))+"\n                                    ")]):t._e(),t._v(" "),"upgradeApp"===e.row.type?a("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(a){t.appAction("upgradeApp",e.row)}}},[t._v("\n                                        "+t._s(t.$t("appControl.upgrade"))+"\n                                    ")]):t._e(),t._v(" "),"installApp"===e.row.type?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){t.appAction("installApp",e.row)}}},[t._v("\n                                        "+t._s(t.$t("appControl.install"))+"\n                                    ")]):t._e()],1)],1)])]}}])})],1)],1),t._v(" "),a("el-tab-pane",{attrs:{name:"appStatusHistory"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-history m-r-5",attrs:{"aria-hidden":"true"}}),t._v("\n                "+t._s(t.$t("appControl.appManagerHistory"))+"\n            ")]),t._v(" "),a("app-history",{ref:"appHistory",attrs:{statusType:t.singleInstallType,selectedAgentId:t.selectedAgentId},on:{isFinished:t.isFinished}})],1)],1)],1)},staticRenderFns:[]};var S=a("C7Lr")(b,y,!1,function(t){a("X/OW")},"data-v-616ab46b",null).exports,A={name:"batchAppcontrol",data:function(){var t=this;return{activeName:"appMarket",appTableData:[],defaultImg:'this.src="static/imgs/default_apk.png"',dialogTasknameVisible:!1,filename:"",pkgname:"",version:"",address:"",versioncode:"",appStatusForm:{taskname:""},rules:{taskname:{required:!0,validator:function(e,a,s){if(!new RegExp(/^(?![._-\s])[\u4E00-\u9FA5A-Za-z0-9_\-\.\s]{1,12}$/).test(a))return s(new Error(t.$t("global.verifyShortError")));s()},trigger:"blur"}},batchInstallType:l.k,cid:"",appOptions:[],disableAppArray:l.o,appType:"uninstallApp",whitelist:!1,isShowOverview:!1,local_taskname:"",success:0,installing:0,failed:0,listLoading:!1,keywords:""}},props:{selectedAgentsData:{type:Array,default:[]},groupname:{type:String,default:""},isSingleMode:{type:Boolean,default:!0}},components:{appHistory:m,cardTemp:v.a},methods:{handleCommand:function(t){var e=t.appInfo;this.cid=t.id,"system"===this.appType||"desktop"===this.appType?(this.address="",this.filename=e.appName,this.pkgname=e.packageName,this.version=e.versionName,this.versioncode=e.versionCode):(this.address=e.address,this.filename=e.appname,this.pkgname=e.package,this.version=e.version,this.versioncode=e.versioncode),this.appStatusForm.taskname="",this.dialogTasknameVisible=!0},filterType:function(t,e){return e.type===t},getSensorStatus:function(){var t=this;if(this.isSingleMode)console.error("Cannot operate in a single mode");else if(0!=this.selectedAgentsData.length){var e=[],a=[];this.listLoading=!0,Object(p.e)(this.selectedAgentsData[0].value,o.c.getAllAppInfo).then(function(s){t.listLoading=!1,Object(r.a)(s,function(s){if("CONTENT"==s.status&&s.content.value){var i=JSON.parse(s.content.value).data;t.appOptions=i,"[object Array]"===Object.prototype.toString.call(i)&&i.length>0&&i.forEach(function(t){var s={type:"uninstallApp",appname:t.appName,package:t.packageName,versioncode:t.versionCode,version:t.versionName,address:"",raid:"",isKioskApp:t.isKioskApp,inwhitelist:t.inWhiteList};"third"===t.type&&e.push(s),a.push(s)})}t.getRepoApps(e,a)})})}else console.error("getSensorStatus: agentData is null")},removeObjInArray:function(t,e){"[object Array]"===Object.prototype.toString.call(t)?t.forEach(function(a,s){a.package===e&&t.splice(s,1)}):console.error("data is not array")},getRepoApps:function(t,e){var a=this;if("[object Array]"==Object.prototype.toString.call(t)&&"[object Array]"==Object.prototype.toString.call(e)){var s={},i={};this.listLoading=!0,Object(c.a)().then(function(n){a.listLoading=!1,Object(r.a)(n,function(n){if("success"===n.status){"[object Array]"===Object.prototype.toString.call(n.data)&&n.data.forEach(function(a){null!=a.versionName&&a.versionName;s={type:"installApp",darkname:a.repo.darkname,appname:a.filename,package:a.pkgname,versioncode:a.versioncode,version:a.versionname,address:a.address,raid:a.raid,isKioskApp:"false",inwhitelist:"false"},t.push(s),e.forEach(function(s,n){a.pkgname===s.package&&(t.pop(),e[n].address=a.address,e[n].raid=a.raid,Number(a.versioncode)>Number(s.versioncode)&&(i={type:"upgradeApp",darkname:a.repo.darkname,appname:a.filename,package:a.pkgname,versioncode:a.versioncode,version:a.versionname,address:a.address,raid:a.raid,isKioskApp:"false",inwhitelist:"false"},t.push(i)))})})}a.appTableData=t.reverse()})})}else console.error("getRepoApps parameter is not array")},batchSetAppSensor:function(t,e){var a=this;if(void 0!==o.c[t]){_g.openGlobalLoading();var s={groupname:this.groupname,taskname:this.appStatusForm.taskname,filename:this.filename,pkgname:this.pkgname,version:this.version,versioncode:this.versioncode,downloadpath:e},i=this.appStatusForm.taskname;this.dialogTasknameVisible=!1,Object(p.a)(o.c[t],s).then(function(t){Object(r.a)(t,function(t){"CHANGED"==t.status?(Object(u.f)("local_taskname",i),a.activeName="appStatusHistory",a.$refs.appHistory.intervalGetAppStatusHistory()):_g.handleError(t)})})}else this.$swal("",this.$t("global.functionNotSupport"),"info",{button:this.$t("global.confirm")})},batchInstallApp:function(){var t=this;0!==this.selectedAgentsData.length?this.$refs.appStatusForm.validate(function(e){e&&t.batchSetAppSensor(t.cid,t.address)}):this.$swal("",this.$t("global.devicesOffline"),"info",{button:this.$t("global.confirm")})},selectBatchInstallApp:function(t,e){this.cid=t,this.address=e.address,this.filename=e.appname,this.pkgname=e.package,this.version=e.version,this.versioncode=e.versioncode,this.appStatusForm.taskname="",this.dialogTasknameVisible=!0},initApkInfo:function(){this.filename="",this.pkgname="",this.version="",this.address="",this.appStatusForm.taskname="",this.cid=""},getBatchAppStatusCount:function(){var t=this,e=Object(u.c)("local_taskname");if(!e)return console.error("getBatchAppStatusCount:localStorage(local_taskname) is null"),void(this.isShowOverview=!1);Object(h.k)(e,l.k).then(function(a){Object(r.a)(a,function(a){a&&(t.local_taskname=e,t.installing=a.installing,t.failed=a.fail,t.success=a.success,t.total>0&&"appStatusHistory"===t.activeName?t.isShowOverview=!0:t.isShowOverview=!1)})})},initData:function(){this.appTableData=[]},getSrc:function(t){return t?Object(d.d)()+"/getAppIcon/"+t:"static/imgs/default_apk.png"},handleClick:function(t){"appStatusHistory"===t.name?this.getBatchAppStatusCount():this.isShowOverview=!1},isFinished:function(){this.getSensorStatus()},getServerStatus:function(){var t=this;if(0!=this.selectedAgentsData.length){Object(p.e)(this.selectedAgentsData[0].value,o.b.whitelist).then(function(e){Object(r.a)(e,function(e){if("CONTENT"===e.status){var a=e.content.value;t.whitelist="boolean"==typeof a?a:"true"===a||"false"===a?"true"===a:a}})})}else console.error("getServerStatus: agentData is null")},disableOperation:function(){this.$swal("",this.$t("appControl.appNotInWhitelist"),"info",{button:this.$t("global.confirm")})}},computed:{isShowSearchInput:function(){return"appMarket"===this.activeName},total:function(){return this.success+this.installing+this.failed}},watch:{isSingleMode:function(t){t||this.initData()},groupname:function(t){!this.isSingleMode&&t&&(this.initData(),this.getSensorStatus(),this.getServerStatus())}}},w={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:!t.isSingleMode,expression:"!isSingleMode"}],staticClass:"appStatusContent p-r"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowSearchInput,expression:"isShowSearchInput"}],staticClass:"search"},[a("el-input",{staticClass:"w-250 m-l-10",attrs:{size:"small",placeholder:t.$t("appControl.keywordHolder")},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}}),t._v(" "),a("i",{staticClass:"fa fa-search search-icon",attrs:{"aria-hidden":"true"}})],1),t._v(" "),a("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"appMarket"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-sellsy m-r-5",attrs:{"aria-hidden":"true"}}),t._v("\n                "+t._s(t.$t("appControl.appMarket"))+"\n            ")]),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.appTableData.filter(function(e){return!t.keywords||e.appname.toLowerCase().includes(t.keywords.toLowerCase())}),"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:"",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[a("img",{staticStyle:{width:"52px"},attrs:{src:t.getSrc(e.row.raid),onerror:t.defaultImg,alt:"no img"}})])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"appname",label:t.$t("appControl.appName"),"min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"package",label:t.$t("appControl.packageName"),"min-width":"120",sortable:""}}),t._v(" "),a("el-table-column",{attrs:{prop:"version",label:t.$t("appControl.versionName"),"min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"type",label:t.$t("appControl.action"),"min-width":"120",filters:[{text:t.$t("appControl.uninstall"),value:"uninstallApp"},{text:t.$t("appControl.install"),value:"installApp"},{text:t.$t("appControl.upgrade"),value:"upgradeApp"}],"filter-method":t.filterType,"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[a("span",[a("el-button-group",["uninstallApp"===e.row.type?a("el-button",{attrs:{size:"small",type:"danger",disabled:t.disableAppArray.indexOf(e.row.package)>-1},on:{click:function(a){t.selectBatchInstallApp("uninstallApp",e.row)}}},[t._v("\n                                        "+t._s(t.$t("appControl.uninstall"))+"\n                                    ")]):t._e(),t._v(" "),"upgradeApp"===e.row.type?a("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(a){t.selectBatchInstallApp("upgradeApp",e.row)}}},[t._v("\n                                        "+t._s(t.$t("appControl.upgrade"))+"\n                                    ")]):t._e(),t._v(" "),"installApp"===e.row.type?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){t.selectBatchInstallApp("installApp",e.row)}}},[t._v("\n                                        "+t._s(t.$t("appControl.install"))+"\n                                    ")]):t._e()],1)],1)])]}}])})],1)],1),t._v(" "),a("el-tab-pane",{attrs:{name:"appStatusHistory"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-history m-r-5",attrs:{"aria-hidden":"true"}}),t._v("\n                "+t._s(t.$t("appControl.appManagerHistory"))+"\n            ")]),t._v(" "),a("app-history",{ref:"appHistory",attrs:{statusType:t.batchInstallType,groupname:t.groupname},on:{getStatusCount:t.getBatchAppStatusCount,isFinished:t.isFinished}})],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogTasknameVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogTasknameVisible=e},close:function(e){t.initApkInfo()}}},[a("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[a("i",{staticClass:"fa fa-level-up m-r-10"}),t._v("\n            "+t._s(t.$t("appControl.batchInstallApk"))+"\n        ")]),t._v(" "),a("el-form",{ref:"appStatusForm",attrs:{model:t.appStatusForm,rules:t.rules}},[a("el-form-item",{attrs:{label:t.$t("label.taskName"),"label-width":"230px",prop:"taskname"}},[a("el-input",{staticClass:"max-w-350",attrs:{autocomplete:"off",placeholder:t.$t("appControl.installAppTaskName")},model:{value:t.appStatusForm.taskname,callback:function(e){t.$set(t.appStatusForm,"taskname","string"==typeof e?e.trim():e)},expression:"appStatusForm.taskname"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogTasknameVisible=!1}}},[t._v(t._s(t.$t("global.cancel")))]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.batchInstallApp()}}},[t._v(t._s(t.$t("global.confirm")))])],1)],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowOverview,expression:"isShowOverview"}],staticClass:"appStatusCount"},[a("span",[t._v(t._s(t.$t("label.taskName"))+" "+t._s(t.local_taskname))]),t._v(" "),a("span",[t._v(t._s(t.$t("appControl.total"))+" "+t._s(t.total))]),t._v(" "),a("span",[t._v(t._s(t.$t("appControl.deploying"))+" "+t._s(t.installing))]),t._v(" "),a("span",[t._v(t._s(t.$t("appControl.success"))+" "+t._s(t.success))]),t._v(" "),a("span",[t._v(t._s(t.$t("appControl.failed"))+" "+t._s(t.failed))])])],1)},staticRenderFns:[]};var _=a("C7Lr")(A,w,!1,function(t){a("F0oJ")},"data-v-4d7b50d6",null).exports,k={name:"controlAppcontrol",data:function(){return{selectedAgentId:"",selectedAgentsData:[],isSingleMode:!0,groupname:"",isDisabledOffDev:!0,isOffline:!1,groupType:l.u.android,groupTypeArray:[l.u.android]}},components:{selectDevice:s.a,selectGroup:n.a,modeSwitch:i.a,singleControl:S,batchControl:_},methods:{getDeviceOption:function(t){this.selectedAgentId=t},getGroupOption:function(t){this.selectedAgentsData=t},initData:function(){this.selectedAgentId="",this.groupname="",this.selectedAgentsData=[]},changeMode:function(t){this.initData(),this.isSingleMode=!t},getGroupName:function(t){this.groupname=t},isDisabled:function(t){this.isDisabledOffDev=t},isOfflineDev:function(t){this.isOffline=t}}},C={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content-box"},[a("div",{staticClass:"title-box"},[a("p",{staticClass:"header-line"},[a("i",{staticClass:"fa fa-sliders m-r-10"}),t._v("\n            "+t._s(t.$t("appControl.appDeploy"))+"\n            \n        ")])]),t._v(" "),a("div",{staticClass:"select-box"},[a("mode-switch",{on:{"mode-status":t.changeMode}}),t._v(" "),a("span",{staticClass:"vertical"}),t._v(" "),a("select-group",{attrs:{isSingleMode:t.isSingleMode,groupType:t.groupTypeArray},on:{"select-getDeviceOptions":t.getGroupOption,"select-getGroupName":t.getGroupName}}),t._v(" "),a("select-device",{attrs:{isSingleMode:t.isSingleMode,isDisabledOffDev:t.isDisabledOffDev,groupType:t.groupType},on:{"select-device":t.getDeviceOption,isOfflineDev:t.isOfflineDev}})],1),t._v(" "),a("div",{staticClass:"table-box"},[a("single-control",{attrs:{selectedAgentId:t.selectedAgentId,isSingleMode:t.isSingleMode,isOffline:t.isOffline},on:{isDisabled:t.isDisabled}}),t._v(" "),a("batch-control",{attrs:{selectedAgentsData:t.selectedAgentsData,isSingleMode:t.isSingleMode,groupname:t.groupname}})],1)])},staticRenderFns:[]};var $=a("C7Lr")(k,C,!1,function(t){a("QO1B")},"data-v-e8704942",null);e.default=$.exports}});
//# sourceMappingURL=14.eb765282b466643ee7c9.js.map