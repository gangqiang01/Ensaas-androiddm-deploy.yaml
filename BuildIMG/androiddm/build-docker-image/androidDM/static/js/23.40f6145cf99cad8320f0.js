webpackJsonp([23],{SOx0:function(t,e){},So77:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("3cXf"),a=s.n(i),n=s("42+z"),o=s("HvBW"),r=s("/eZD"),l=s("jwu5"),c=s("jnx8"),u=s("YMj5"),d=s("UuJD"),h=(s("22O3"),s("C+p8")),p=(s("OT2R"),{name:"dockerControlHistory",data:function(){return{appStatusHistoryTableList:[],isshow:!1,limit:10,dataCount:0,currentPage:1,multipleSelection:[],isShowBtnGroup:!1,clearLoading:!1,batchDeleteAppStatusHistory:d.a,intervalTime:7e3,isInterval:!1,listLoading:!1,singleInstallType:r.I,batchAppType:r.d,batchContainerType:r.f,statusArray:[]}},components:{btnGroup:h.a},props:{statusType:{default:r.J,type:String},selectedAgentId:{default:"",type:String},groupname:{default:"",type:String}},methods:{selectItem:function(t){this.multipleSelection=t},checkSelectable:function(t){return 0==!t.status},handleCurrentChange:function(t){this.currentPage=t||1,this.intervalGetServiceStatusHistory()},deleteHistory:function(t){var e=this;_g.swalInfoDo(this.$t("global.areYouSure"),this.$t("global.delete"),this.$t("global.confirm"),this.$t("global.cancel")).then(function(s){s&&(e.listLoading=!0,Object(d.d)(t).then(function(t){e.listLoading=!1,Object(c.a)(t,function(t){"CHANGED"===t.status?e.$swal("",e.$t("global.success"),"success",{button:e.$t("global.confirm")}).then(function(){e.intervalGetServiceStatusHistory()}):_g.handleError(t)})}))})},checkAppStatusData:function(){Object(d.e)(this.selectedAgentId,this.statusType)},getAppStatusHistoryByGroupname:function(){var t=this;this.groupname||console.error("[getAppStatusHistoryByGroupname]groupname is empty"),!1===this.isInterval&&(this.listLoading=!0),this.statusArray.length>0?Object(d.h)(this.groupname,this.statusType,this.currentPage,this.limit,this.statusArray).then(function(e){t.listLoading=!1,Object(c.a)(e,function(e){t.assignAppStatusData(e)})}):Object(d.j)(this.groupname,this.statusType,this.currentPage,this.limit).then(function(e){t.listLoading=!1,Object(c.a)(e,function(e){t.assignAppStatusData(e)})})},getAppStatusHistoryBydevid:function(){var t=this;this.selectedAgentId?(!1===this.isInterval&&(this.listLoading=!0),this.statusArray.length>0?Object(d.g)(this.selectedAgentId,this.statusType,this.currentPage,this.limit,this.statusArray).then(function(e){t.listLoading=!1,Object(c.a)(e,function(e){t.assignAppStatusData(e)})}):Object(d.i)(this.selectedAgentId,this.statusType,this.currentPage,this.limit).then(function(e){t.listLoading=!1,Object(c.a)(e,function(e){t.assignAppStatusData(e)})})):console.error("[getAppStatusHistoryBydevid]selectedAgentId is empty")},assignAppStatusData:function(t){if("[object Object]"===Object.prototype.toString.call(t)&&"[object Array]"===Object.prototype.toString.call(t.data)){this.dataCount=t.count,this.appStatusHistoryTableList=t.data,this.isshow=this.dataCount>this.limit,this.isShowBtnGroup=this.dataCount>0;var e=!0;t.data.forEach(function(t){0==t.status&&(e=!1)}),e&&(this.$emit("isFinished"),window.clearInterval(_g.timer),_g.timer=null)}else window.clearInterval(_g.timer),_g.timer=null},intervalGetServiceStatusHistory:function(){var t=this;this.getAppStatusHistoryBydevid(),null===_g.timer&&(_g.timer=window.setInterval(function(){t.getAppStatusHistoryBydevid(),t.isInterval=!0},this.intervalTime))},filterStatus:function(t){this.statusArray=t.status,this.currentPage=1,_g.isArray(this.statusArray)&&this.intervalGetServiceStatusHistory()},resetAppSensor:function(t,e,s){var i=this;this.listLoading=!0,Object(u.g)(e,t,s).then(function(t){i.listLoading=!1,Object(c.a)(t,function(t){"CHANGED"==t.status?(i.currentPage=1,i.intervalGetServiceStatusHistory()):_g.handleError(t)})})},reinstall:function(t){var e=this;_g.swalInfoDo(this.$t("global.areYouSure"),this.$t("dockerControl.repeat"),this.$t("global.confirm"),this.$t("global.cancel")).then(function(s){if(s){var i={taskname:t.taskname,name:t.pkgname,containerId:t.versionname};e.resetAppSensor(t.target,t.deviceId,i)}})},isSuccess:function(t){t&&this.intervalGetServiceStatusHistory()},clearAll:function(){var t=this;_g.swalInfoDo(this.$t("global.areYouSure"),this.$t("global.clearAll"),this.$t("global.confirm"),this.$t("global.cancel")).then(function(e){e&&(t.clearLoading=!0,Object(d.b)(t.selectedAgentId,t.statusType).then(function(e){t.clearLoading=!1,Object(c.a)(e,function(e){"CHANGED"===e.status?t.$swal("",t.$t("global.success"),"success",{button:t.$t("global.confirm")}).then(function(){t.intervalGetServiceStatusHistory()}):_g.handleError(e)})}))})},initData:function(){this.appStatusHistoryTableList=[],this.isShowBtnGroup=!1,this.isshow=!1,this.isInterval=!1,this.currentPage=1}},created:function(){},beforeDestroy:function(){window.clearInterval(_g.timer),_g.timer=null},watch:{groupname:function(t){t&&(this.initData(),this.checkAppStatusData(),this.intervalGetServiceStatusHistory())},selectedAgentId:function(t){t&&(this.initData(),this.checkAppStatusData(),this.intervalGetServiceStatusHistory())}}}),v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"appStatusHistoryTable",staticStyle:{width:"100%"},attrs:{data:t.appStatusHistoryTableList,"tooltip-effect":"dark","default-sort":{prop:"ts",order:"descending"}},on:{"selection-change":t.selectItem,"filter-change":t.filterStatus}},[i("el-table-column",{attrs:{type:"selection","min-width":"50",selectable:t.checkSelectable}}),t._v(" "),i("el-table-column",{attrs:{prop:"devname",label:t.$t("dockerControl.deviceName"),"min-width":"120"}}),t._v(" "),i("el-table-column",{attrs:{prop:"pkgname",label:t.$t("dockerControl.serviceName"),"min-width":"140"}}),t._v(" "),i("el-table-column",{attrs:{label:t.$t("dockerControl.beginTime"),"min-width":"130",prop:"ts"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("time")(e.row.ts))+"\n            ")]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"target",label:t.$t("dockerControl.function"),"min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("appStatusFunction")(e.row.target))+"\n            ")]}}])}),t._v(" "),i("el-table-column",{attrs:{"column-key":"status",prop:"status",label:t.$t("dockerControl.installStatus"),"min-width":"140",filters:[{text:t.$t("global.success"),value:2},{text:t.$t("global.failed"),value:1},{text:t.$t("global.running"),value:0}],"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.status?i("img",{staticStyle:{width:"50px",height:"10px"},attrs:{src:s("PLes"),alt:""}}):t._e(),t._v(" "),2==e.row.status?i("span",{staticClass:"badge bg-green"},[t._v(t._s(t.$t("global.success")))]):t._e(),t._v(" "),1==e.row.status?i("span",{staticClass:"badge bg-DimGray"},[t._v(t._s(t.$t("global.failed")))]):t._e()]}}])}),t._v(" "),i("el-table-column",{attrs:{label:t.$t("dockerControl.errorStatus"),"min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("appErrorStatus")(""+e.row.errorcode))+"\n            ")]}}])}),t._v(" "),i("el-table-column",{attrs:{label:t.$t("dockerControl.action"),"min-width":"175",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",[i("el-button-group",[i("el-button",{attrs:{size:"mini",type:"danger",disabled:0==e.row.status},on:{click:function(s){t.deleteHistory(e.row.aisid)}}},[t._v("\n                                "+t._s(t.$t("global.delete"))+"\n                        ")]),t._v(" "),i("el-button",{attrs:{size:"mini",type:"primary",disabled:1!=e.row.status},on:{click:function(s){t.reinstall(e.row)}}},[t._v("\n                                "+t._s(t.$t("dockerControl.repeat"))+"\n                        ")])],1)],1)]}}])})],1),t._v(" "),i("btn-group",{directives:[{name:"show",rawName:"v-show",value:t.isShowBtnGroup,expression:"isShowBtnGroup"}],staticClass:"fl m-t-10 cf",attrs:{selectedData:t.multipleSelection,isDelete:!0,isMove:!1,tid:"aisid",delApi:t.batchDeleteAppStatusHistory},on:{result:t.isSuccess}}),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.clearLoading,expression:"clearLoading"},{name:"show",rawName:"v-show",value:t.isShowBtnGroup,expression:"isShowBtnGroup"}],staticClass:"fl m-t-10 cf m-l-10",attrs:{size:"small",type:"primary"},on:{click:function(e){t.clearAll()}}},[t._v("\n    "+t._s(t.$t("dockerControl.clearAll"))+"\n    ")]),t._v(" "),i("div",{staticClass:"m-t-10 cf fr"},[i("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.isshow,expression:"isshow"}],attrs:{layout:"prev, pager, next","page-size":t.limit,"current-page":t.currentPage,total:t.dataCount,background:""},on:{"current-change":t.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var f=s("C7Lr")(p,v,!1,function(t){s("SOx0")},"data-v-5a992a50",null).exports,m={name:"comtainercontrol",data:function(){return{selectedAgentId:"",serviceTableData:[],isDisabledOffDev:!0,isOffline:!1,listLoading:!1,productname:"",multipleSelection:[],version:"",singleServiceType:r.J,activeName:"service",keywords:"",cid:"",isFixed:!1,offsetTop:1e4,content:""}},components:{selectDevice:n.a,selectGroup:o.a,serviceHistory:f,editor:s("xds+")},methods:{getSensorStatus:function(){var t=this,e={};this.selectedAgentId?(this.productname&&(e.productname=this.productname,e.version=this.version),this.listLoading=!0,Object(u.e)(this.selectedAgentId,l.h.getService,e).then(function(e){t.listLoading=!1,Object(c.a)(e,function(e){"CONTENT"==e.status&&(t.serviceTableData=JSON.parse(e.content.value))})})):console.error("agentId is empty")},editorInit:function(){s("aDfU"),s("sYys"),s("hww6"),s("y9Ym"),s("J4HJ"),s("2LVu")},getDeviceOption:function(t){this.initData(),this.selectedAgentId=t,this.getSensorStatus()},initData:function(){this.serviceTableData=[]},initContainerInfo:function(){this.cid=""},isDisabled:function(t){this.isDisabledOffDev=t},isOfflineDev:function(t){this.isOffline=t},handleClick:function(t){"serviceStatusHistory"===t.name?(this.$route.query.name&&this.$refs.serviceHistory.intervalGetServiceStatusHistory(),this.isDisabledOffDev=!1):this.isDisabledOffDev=!0},isFinished:function(){this.getSensorStatus()},actionComposeSensor:function(t,e){var s=this;void 0!==l.h[t]?""!=this.selectedAgentId?_g.swalWarnDo(this.$t("global.areYouSure"),this.$t("dockerAction."+t),this.$t("global.confirm"),this.$t("global.cancel")).then(function(i){i&&(_g.openGlobalLoading(),Object(u.b)(s.selectedAgentId,l.h[t],e).then(function(t){Object(c.a)(t,function(t){"CHANGED"==t.status?(s.activeName="serviceStatusHistory",s.$refs.serviceHistory.intervalGetServiceStatusHistory()):_g.handleError(t)})}))}):this.$swal("",this.$t("global.selectDevice"),"info",{button:this.$t("global.confirm")}):this.$swal("",this.$t("global.functionNotSupport"),"info",{button:this.$t("global.confirm")})},selectItem:function(t){this.multipleSelection=t},composeAction:function(t){var e={},s=[],i=this.singleServiceType+(new Date).getTime();this.multipleSelection.forEach(function(t){var e={};e.name=t.name,e.containerId=t.id,s.push(e)}),e.taskname=i,e.content=a()(s),this.actionComposeSensor(t,e)},back:function(){this.$router.go(-1)},filterStatus:function(t,e){return e.state===t},goRouter:function(t){this.$router.push({path:"/main/control/servicedetail",query:{name:t.name,serviceId:t.id,endpoint:this.selectedAgentId}})},showYmlContent:function(){var t=this;this.dialogYamlVisible=!0;var e={};e.productname=this.productname,e.version=this.version,Object(u.e)(this.selectedAgentId,l.h.getComposeContent,e).then(function(e){Object(c.a)(e,function(e){"CONTENT"==e.status&&(t.content=e.content.value)})})},updateYmlContent:function(t){var e={taskname:this.singleServiceType+(new Date).getTime(),projectname:this.productname,version:this.version,downloadpath:this.content};this.actionComposeSensor(t,e)}},created:function(){this.$route.query.name&&(this.productname=this.$route.query.name,this.version=this.$route.query.version,this.selectedAgentId=this.$route.query.endpoint,this.getSensorStatus(),this.showYmlContent(),this.limited=this.$route.query.limited)},computed:{serviceTableList:function(){var t=this;return this.serviceTableData.filter(function(e){return!t.keywords||e.name.toLowerCase().includes(t.keywords.toLowerCase())})},isShowSearchInput:function(){return"service"===this.activeName},removebtndisabled:function(){return!(this.multipleSelection.length>0)},btnGroupIsShow:function(){return"service"==this.activeName}}},g={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content-box"},[s("div",{staticClass:"title-box"},[s("p",{staticClass:"header-line"},[s("i",{staticClass:"fa fa-arrow-left m-r-10 pointer",attrs:{"aria-hidden":"true"},on:{click:function(e){t.back()}}}),t._v("\n            "+t._s(t.$t("dockerControl.serviceList"))+"\n        ")])]),t._v(" "),s("div",{staticClass:"select-box"},[s("div",{staticClass:"service-box m-l-10"},[s("span",{staticClass:"label"},[t._v(t._s(t.$t("dockerControl.projectName"))+":")]),t._v(" "),s("span",{staticClass:"cvalue"},[t._v(t._s(t.productname))])]),t._v(" "),s("div",{staticClass:"service-box m-l-10"},[s("span",{staticClass:"label"},[t._v(t._s(t.$t("dockerControl.version"))+":")]),t._v(" "),s("span",{staticClass:"cvalue"},[t._v(t._s(t.version))])])]),t._v(" "),s("div",{staticClass:"table-box pkgStatusContent"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowSearchInput,expression:"isShowSearchInput"}],staticClass:"search"},[s("el-input",{staticClass:"w-250 m-l-10",attrs:{size:"small",placeholder:t.$t("dockerControl.serviceKeywordHolder")},model:{value:t.keywords,callback:function(e){t.keywords=e},expression:"keywords"}}),t._v(" "),s("i",{staticClass:"fa fa-search search-icon",attrs:{"aria-hidden":"true"}})],1),t._v(" "),s("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[s("el-tab-pane",{attrs:{name:"service"}},[s("span",{attrs:{slot:"label"},slot:"label"},[s("i",{staticClass:"fa fa-sellsy m-r-5",attrs:{"aria-hidden":"listLoading"}}),t._v("\n                    "+t._s(t.$t("dockerControl.service"))+"\n                ")]),t._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.serviceTableList,"tooltip-effect":"dark"},on:{"selection-change":t.selectItem}},[s("el-table-column",{attrs:{prop:"name",label:t.$t("dockerControl.name"),"min-width":"90",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"url pointer",on:{click:function(s){t.goRouter(e.row)}}},[t._v("\n                                "+t._s(e.row.name)+"\n                            ")])]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"image",label:t.$t("dockerControl.image"),"min-width":"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"pointer url",on:{click:function(s){t.goRouter(e.row)}}},[t._v("\n                                "+t._s(e.row.image)+"\n                                "),s("i",{staticClass:"fa fa-pencil-square-o m-l-5",attrs:{"aria-hidden":"true"}})])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("dockerControl.schedulingMode"),"min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"pointer url",on:{click:function(s){t.goRouter(e.row)}}},[t._v("\n                                "+t._s(e.row.schedulingmode)+" "+t._s(e.row.taskstatus)+"\n                                "),s("i",{staticClass:"fa fa-arrows-v m-l-5",attrs:{"aria-hidden":"true"}})])]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"lastupdate",label:t.$t("dockerControl.lastupdate"),"min-width":"120",sortable:""}}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("dockerControl.publishedPort"),"min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                            "+t._s(t._f("none")(e.row.ports))+"\n                        ")]}}])})],1)],1),t._v(" "),t.limited&&"false"!=t.limited?t._e():s("el-tab-pane",{attrs:{name:"edit"}},[s("span",{attrs:{slot:"label"},slot:"label"},[s("i",{staticClass:"fa fa-pencil-square-o m-r-5",attrs:{"aria-hidden":"listLoading"}}),t._v("\n                    "+t._s(t.$t("dockerControl.editComposeFile"))+"\n                ")]),t._v(" "),s("div",{staticClass:"text-center"},[s("editor",{attrs:{lang:"html",theme:"chrome",height:"550",options:{enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,tabSize:2,fontSize:14,showPrintMargin:!1}},on:{init:t.editorInit},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),t._v(" "),s("div",{staticClass:"m-t-10"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.updateYmlContent("updateSwarmContent")}}},[t._v(t._s(t.$t("global.update")))])],1)]),t._v(" "),s("el-tab-pane",{attrs:{name:"serviceStatusHistory"}},[s("span",{attrs:{slot:"label"},slot:"label"},[s("i",{staticClass:"fa fa-history m-r-5",attrs:{"aria-hidden":"true"}}),t._v("\n                    "+t._s(t.$t("dockerControl.history"))+"\n                ")]),t._v(" "),s("service-history",{ref:"serviceHistory",attrs:{statusType:t.singleServiceType,selectedAgentId:t.selectedAgentId},on:{isFinished:t.isFinished}})],1)],1)],1)])},staticRenderFns:[]};var b=s("C7Lr")(m,g,!1,function(t){s("dRtO")},"data-v-0cb3e6e8",null);e.default=b.exports},dRtO:function(t,e){}});
//# sourceMappingURL=23.40f6145cf99cad8320f0.js.map